/**
 * ì œì´ì§€ëŠ” í•˜ë£¨ ì¼ì •ìœ¼ë¡œ ì›Œí¬ìˆì„ ê³„íší•˜ê³  ìžˆë‹¤.
 * ëª¨ë“  ì§ì›ì„ ì°¸ì„ì‹œí‚¬ ìˆ˜ ì—†ì–´, ì•„ëž˜ì™€ ê°™ì€ ê¸°ì¤€ìœ¼ë¡œ ì§ì›ë“¤ì„ ì„ ë°œí•œë‹¤.
 * 1. ëª¨ë“  íŒ€ì€ ìµœì†Œ 1ëª… ì´ìƒì˜ ì§ì›ì„ ì›Œí¬ìˆì— ì°¸ì„ì‹œì¼œì•¼ í•œë‹¤.
 * 2. íšŒì‚¬ì˜ ë§¤ì¶œ ì†ì‹¤ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´
 *    ì›Œí¬ìˆì— ì°¸ì„í•˜ëŠ” ì§ì›ë“¤ì˜ í•˜ë£¨í‰ê·  ë§¤ì¶œì•¡ì˜ í•©ì´ ìµœì†Œê°€ ë˜ì–´ì•¼ í•œë‹¤.
 * ë§Œì•½, ì„ ë°œëœ í•œ ëª…ì˜ ì§ì›ì´ ë‘ íŒ€ì— ì†í•´ìžˆë‹¤ë©´, ë‘ íŒ€ ëª¨ë‘ ì°¸ì„í•œ ê²ƒìœ¼ë¡œ ì¸ì •ëœë‹¤.
 *
 * [ ì¡°ì§ë„ ì„¤ëª… ]
 * - ì§ì› ì •ë³´: [ì§ì›ë²ˆí˜¸, í•˜ë£¨í‰ê·  ë§¤ì¶œì•¡]
 * - CEOë¥¼ í¬í•¨í•œ ëª¨ë“  ì§ì›ì€ íŒ€ìž¥ ë˜ëŠ” íŒ€ì›ì´ë¼ëŠ” ì§ìœ„ë¥¼ ê°€ì§€ê³  ìžˆë‹¤.
 *   í™”ì‚´í‘œê°€ ì‹œìž‘ë˜ëŠ” ìª½ì´ íŒ€ìž¥, í™”ì‚´í‘œë¥¼ ë°›ëŠ” ìª½ì´ íŒ€ì›ì´ë‹¤.
 *   -> CEOëŠ” í•­ìƒ íŒ€ìž¥ì´ë©°, íŒ€ì›ì¼ ìˆ˜ê°€ ì—†ë‹¤.
 *   -> CEOë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  ì§ì›ë“¤ì€ 1ê°œì˜ í™”ì‚´í‘œë¥¼ ë°›ëŠ”ë‹¤.
 *   -> í•œ ì§ì›ì€ ìµœëŒ€ 2ê°œì˜ íŒ€ì— ì†Œì†ë  ìˆ˜ ìžˆë‹¤.
 *      -> ë¬´ì¡°ê±´ í•˜ë‚˜ì˜ íŒ€ì—ì„œëŠ” íŒ€ìž¥, ë‹¤ë¥¸ íŒ€ì—ì„œëŠ” íŒ€ì›ì´ì–´ì•¼ í•œë‹¤.
 *
 * @param {*} sales ì§ì›ë“¤ì˜ í•˜ë£¨í‰ê·  ë§¤ì¶œì•¡ ê°’ì„ ë‹´ì€ ë°°ì—´ (2~300_000)
 * @param {*} links íŒ€ìž¥-íŒ€ì›ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” 2ì°¨ì› ë°°ì—´
 *                  (sales ë°°ì—´í¬ê¸° - 1) , [íŒ€ìž¥ë²ˆí˜¸, íŒ€ì›ë²ˆí˜¸]
 *                  1ë²ˆì€ CEOë¡œ ê³ ì •ëœë‹¤.
 * @returns ì°¸ì„í•˜ëŠ” ì§ì›ë“¤ì˜ í•˜ë£¨í‰ê·  ë§¤ì¶œì•¡ì˜ ìµœì†Œ í•©
 *
 * ### ë¦¬ë·°
 * - í’€ì´ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
 *   ë¨¼ì €, ì£¼ì–´ì§„ linksë¥¼ ìˆœíšŒí•˜ì—¬ tree êµ¬ì¡°ë¥¼ ìƒì„±í•œë‹¤.
 *   DFSë¡œ treeë¥¼ ìˆœíšŒí•˜ë©´ì„œ,
 *   Pì§ì›ì´ "ì°¸ì—¬í•˜ëŠ” ê²½ìš°"ì™€ "ë¶ˆì°¸í•˜ëŠ” ê²½ìš°"ì— ëŒ€í•œ ìµœì†Œ ë§¤ì¶œì•¡ì„ êµ¬í•˜ê³ ìž í•œë‹¤.
 *   memo[P][0]ì€ Pì§ì›ì´ ë¶ˆì°¸í•˜ëŠ” ê²½ìš°
 *   memo[P][1]ì€ Pì§ì›ì´ ì°¸ì—¬í•˜ëŠ” ê²½ìš°ë¥¼ ì˜ë¯¸í•œë‹¤.
 *
 *   ë¨¼ì €, Pì˜ ëª¨ë“  ìžì‹(C)ì— ëŒ€í•œ sum(min(...memo[C]))ë¥¼ êµ¬í•œë‹¤. (= sum_child)
 *   ì¦‰, í•´ë‹¹ ìžì‹ì´ ì°¸ì—¬í•˜ëŠ” ê²½ìš°ì™€ ë¶ˆì°¸í•˜ëŠ” ê²½ìš° ì¤‘ ë§¤ì¶œì•¡ì´ ì ì€ ê²½ìš°ë¥¼ ì„ íƒí•˜ì—¬ ë”í•´ì¤€ë‹¤.
 *
 *   memo[P][1]ì€ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°í•œë‹¤. (P ì°¸ì—¬)
 *   memo[P][1] = sales[P] + sum_child
 *
 *   memo[P][0]ì€ ë‹¤ìŒê³¼ ê°™ì´ ë‘ ê°€ì§€ ê²½ìš°ë¡œ ë‚˜ë‰œë‹¤. (P ë¶ˆì°¸)
 *   - ìžì‹ ì¤‘ í•œ ëª…ì´ë¼ë„ ì°¸ì—¬í•˜ëŠ” ê²½ìš°
 *   - ëª¨ë“  ìžì‹ì´ ë¶ˆì°¸í•˜ëŠ” ê²½ìš°
 *
 *   1. ìžì‹ ì¤‘ í•œ ëª…ì´ë¼ë„ ì°¸ì—¬í•˜ëŠ” ê²½ìš° ëŠ”,
 *   Pê°€ ì„ íƒë  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì¡°ê±´ì„ ë§Œì¡±í•œë‹¤.
 *   ë”°ë¼ì„œ, memo[P][0] = sum_childì´ë‹¤.
 *
 *   2. ëª¨ë“  ìžì‹ì´ ë¶ˆì°¸í•˜ëŠ” ê²½ìš°ëŠ”,
 *   Pê°€ ì°¸ì—¬í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ ìžì‹ ì¤‘ í•œ ëª…ì´ë¼ë„ ì°¸ì—¬ ì‹œì¼œì•¼ í•œë‹¤.
 *   ë”°ë¼ì„œ, ìžì‹ë“¤ ì¤‘ memo[P][1] - memo[P][0]ì˜ ê°’ì´ ê°€ìž¥ ìž‘ì€ ìžì‹ì„ ê°•ì œë¡œ ì°¸ì—¬ì‹œì¼œì•¼ í•œë‹¤. (ë§¤ì¶œ ì†í•´ê°€ ì ì€ ìžì‹)
 *   "memo[P][1] - memo[P][0]"ëŠ” memo[P][0] ëŒ€ì‹  memo[P][1]ì„ ì„ íƒí–ˆì„ ë•Œì˜ ì°¨ì´ê°€ ê°€ìž¥ ì ì€ ìžì‹ì„ ì˜ë¯¸í•œë‹¤.
 *   ì¦‰, memo[P][0] = sum_child + min(memo[C][1] - memo[C][0])ì´ë‹¤.
 *
 *   íŠ¹ì • ìžì‹ì˜ ì°¸ì—¬ì—¬ë¶€ë¥¼ íŒë³„í•˜ê¸° ìœ„í•´ì„œëŠ”,
 *   "memo[C][0] > memo[C][1]" ì¡°ê±´ì„ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
 *   sum_childì—ì„œëŠ” memo[C][0]ì™€ memo[C][1] ì¤‘ ìž‘ì€ ê°’ì„ ì„ íƒí•˜ì—¬ ì €ìž¥í•œë‹¤.
 *   ë”°ë¼ì„œ, memo[C][0] > memo[C][1]ì¸ ê²½ìš° memo[C][1]ë¥¼ ì„ íƒí•˜ê¸° ë•Œë¬¸ì— Cê°€ ì°¸ì—¬í•¨ì„ ì˜ë¯¸í•œë‹¤.
 *
 *   ë§ˆì§€ë§‰ìœ¼ë¡œ, min(...memo[1])ë¥¼ ë°˜í™˜í•˜ë©´, ìµœì†Œí™”ëœ ë§¤ì¶œì•¡ì˜ í•©ì„ êµ¬í•  ìˆ˜ ìžˆë‹¤.
 *
 * - ì–´ë µë‹¤..
 *   ì–´ë–¤ ì‹ìœ¼ë¡œ ìµœì†Œ ë§¤ì¶œì•¡ì„ ì €ìž¥í•´ì•¼ í• ì§€ ê°ì´ ì•ˆ ìž¡í˜€ì„œ ê²°êµ­ í’€ì´ë¥¼ ë³¸ ë¬¸ì œì´ë‹¤. ðŸ˜‚
 */

function solution(sales, links) {
    const N = sales.length + 1;

    const tree = createTree(N, links);
    const memo = Array.from(Array(N), () => Array(2).fill(0));
    DFS(1);

    return Math.min(...memo[1]);

    function DFS(parent) {
        tree[parent].forEach((child) => DFS(child));

        memo[parent] = [
            sumSaleWhenSelectChild(parent),
            sumSaleWhenSelectParent(parent),
        ];
    }

    function sumSaleWhenSelectParent(parent) {
        return sales[parent - 1] + sumSaleOfChilds(parent);
    }

    function sumSaleWhenSelectChild(parent) {
        const sumSale = sumSaleOfChilds(parent);

        if (isNotExistChild(parent) || isExistSelectedChild(parent))
            return sumSale;

        return sumSale + selectChildWithMinSale(parent);
    }

    function isNotExistChild(parent) {
        return tree[parent].length === 0;
    }

    function isExistSelectedChild(parent) {
        return tree[parent].filter((child) => memo[child][0] > memo[child][1])
            .length;
    }

    function sumSaleOfChilds(parent) {
        return tree[parent]
            .map((child) => Math.min(...memo[child]))
            .reduce((sumSale, sale) => sumSale + sale, 0);
    }

    function selectChildWithMinSale(parent) {
        return Math.min(
            ...tree[parent].map((child) => memo[child][1] - memo[child][0]),
        );
    }
}

function createTree(N, links) {
    return links.reduce(
        (tree, [parent, child]) => {
            tree[parent].push(child);
            return tree;
        },
        Array.from(Array(N), () => []),
    );
}

/****** TEST CASE *******/

console.log(
    solution(
        [14, 17, 15, 18, 19, 14, 13, 16, 28, 17],
        [
            [10, 8],
            [1, 9],
            [9, 7],
            [5, 4],
            [1, 5],
            [5, 10],
            [10, 6],
            [1, 3],
            [10, 2],
        ],
    ),
);

console.log(
    solution(
        [5, 6, 5, 3, 4],
        [
            [2, 3],
            [1, 4],
            [2, 5],
            [1, 2],
        ],
    ),
);

console.log(
    solution(
        [5, 6, 5, 1, 4],
        [
            [2, 3],
            [1, 4],
            [2, 5],
            [1, 2],
        ],
    ),
);
